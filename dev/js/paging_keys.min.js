function HotKey(a){this.target=a||document;this._keyfunc={};this.init()}HotKey.kc2char=function(b){var c=function(f,e){return f<=b&&b<=e};var a="space pageup pagedown end home left up right down".split(" ");var d={8:"back",9:"tab",13:"enter",16:"shift",17:"ctrl",46:"delete"};return(c(65,90)?String.fromCharCode(b+32):c(48,57)?String.fromCharCode(b):c(96,105)?String.fromCharCode(b-48):c(32,40)?a[b-32]:d.hasOwnProperty(b)?d[b]:null)};HotKey.prototype.ignore=/input|textarea/i;HotKey.prototype.init=function(){var a=this;var b=function(c){a.onkeydown(c)};if(this.target.addEventListener){this.target.addEventListener("keydown",b,true)}else{this.target.attachEvent("onkeydown",b)}};HotKey.prototype.onkeydown=function(c){var a=(c.target||c.srcElement).tagName;if(this.ignore.test(a)){return}var b=HotKey.kc2char(c.keyCode);if(c.shiftKey&&b.length==1){b=b.toUpperCase()}if(c.altKey){b="A"+b}if(c.ctrlKey){b="C"+b}if(this._keyfunc.hasOwnProperty(b)){this._keyfunc[b].call(this,c)}};HotKey.prototype.sendKey=function(a){this._keyfunc[a]&&this._keyfunc[a]()};HotKey.prototype.add=function(b,c){if(b.constructor==Array){for(var a=0;a<b.length;a++){this._keyfunc[b[a]]=c}}else{this._keyfunc[b]=c}};HotKey.prototype.remove=function(b){if(b.constructor==Array){for(var a=0;a<b.length;a++){this._keyfunc[b[a]]=function(){}}}else{this._keyfunc[b]=function(){}}};var pagingKeys=function(){var y={nodeSelector:"article.ipsComment",prevPageSelector:"li.ipsPagination_prev > a:last",nextPageSelector:"li.ipsPagination_next > a:last",pagingNavId:"paging-nav",keyNext:"j",keyPrev:"k",keyNextPage:"h",keyPrevPage:"l",keyRefresh:"r",currentItemClass:"ipsComment_current",additionalBodyClass:"paging-keys",bottomAnchor:"replyForm"};var q=[];var v=false;var d=false;var l=false;var f=null;function a(){$(window).scroll(function(){p()})}function c(){return{w:$(window).width(),h:$(window).height(),x:$(window).scrollLeft(),y:$(window).scrollTop()}}function z(B){return $(B)}function u(C){var B=$(C).offset();q.push({id:C.id,y:Math.round(B.top)-20})}function e(){$("#"+y.pagingNavId).css({position:"absolute",right:"10px",top:(i()+10)+"px"})}function i(){return $(window).scrollTop()}function t(){$(window).load(function(B){y.keyNext=ips.getSetting("kbnav_keyNext");y.keyPrev=ips.getSetting("kbnav_keyPrev");y.keyNextPage=ips.getSetting("kbnav_keyNextPage");y.keyPrevPage=ips.getSetting("kbnav_keyPrevPage");y.keyRefresh=ips.getSetting("kbnav_keyRefresh");m();a();CKEDITOR.on("currentInstance",function(C){o()})})}function m(){w();p();x()}function w(){v=false;if(z(y.prevPageSelector)[0]){if(z(y.prevPageSelector)[0].href){q.push({id:"prev",y:0})}}else{q.push({id:null,y:0})}var B=z(y.nodeSelector);for(var C=0;C<B.length;C++){u(B[C])}q.sort(function(F,E){return F.y-E.y});var D=q.length-1;if(z(y.nextPageSelector)[0]){if(z(y.nextPageSelector)[0].href){q.push({id:"next",y:document.body.scrollHeight})}}v=true}function p(){if($(y.pagingNavId)){e()}}function x(){try{d=new HotKey()}catch(B){console.log("Oops, paging_keys requires HotKeys.js (http://la.ma.la/blog/diary_200511041713.htm)");console.log(B)}if(d){if(y.keyNext){d.add(y.keyNext,function(){r(1)})}if(y.keyPrev){d.add(y.keyPrev,function(){r(-1)})}if(y.keyNextPage){d.add(y.keyNextPage,function(){b(1)})}if(y.keyPrevPage){d.add(y.keyPrevPage,function(){b(-1)})}if(y.keyRefresh){d.add(y.keyRefresh,function(){location.reload()})}}}function n(B){location.href=B}function o(){if(d){l=true;d.remove(y.keyNext);d.remove(y.keyPrev);d.remove(y.keyNextPage);d.remove(y.keyPrevPage);d.remove(y.keyRefresh)}}function r(D,B){if(!v){return false}if(B==null){B=j(D)}var C=i();if(B){if(B.id=="prev"||B.id=="next"){if(B.id=="next"){h()}else{g()}return false}if((D>0)&&s()){b(1)}else{if(y.currentItemClass){k(B.id)}window.scrollTo(0,B.y)}}return true}function k(B){if(f){f.removeClass(y.currentItemClass)}f=$("#"+B);f.addClass(y.currentItemClass)}function s(){return(c().h+i()==document.body.scrollHeight)}function j(E,D){if(D==null){D=i()}var C=q.length-1;for(var B=0;B<q.length;B++){if(D<q[B].y){C=B-1;break}}if((E<0&&q[C]&&q[C].y==D)||0<E){C+=E}else{if(s()&&0<E){C++}}C=Math.max(C,0);return q[C]}function A(){var C=document.body.scrollTop;var B=document.body.scrollLeft;var D=document.body.scrollHeight;var E=window.innerHeight;return{top:C,left:B,height:D,clientHeight:E,is_at_top:C==0&&B==0,is_at_last:C+E==D&&B==0}}function b(C){var B=A();if(C<0){if(B.is_at_top){g()}else{window.scroll(0,0)}}else{if(B.is_at_last){h()}else{window.scroll(0,B.height)}}}function h(){if(z(y.nextPageSelector)){if(z(y.nextPageSelector).attr("href")!=null){var B=z(".ipsPagination").data("ipspagination-pages");if(!B){B=z(".ipsPagination").data("pages")}if(z(y.nextPageSelector).data("page")<=B){n(z(y.nextPageSelector).attr("href"));o();return true}}}else{return false}}function g(){if(z(y.prevPageSelector)){if(z(y.prevPageSelector).attr("href")!=null){if(z(y.prevPageSelector).data("page")){n(z(y.prevPageSelector).attr("href")+"#"+y.bottomAnchor);o();return true}}}else{return false}}return{init:t,moveToItem:r,movePage:b,currentItem:j,disableHotKeys:o,config:y,item_map:q}}();pagingKeys.init();